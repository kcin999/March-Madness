"""A Script to help associate Random Forest's Features with the Column Names

To Run:

    * Put the query used in line 11 as a string
    * Put the Feature Importance List as a string in line 15
    * Run the file.
"""
from prettytable import PrettyTable
from machine_learning import get_data

# Query Goes Here
QUERY = "SELECT schst.Result, school_stats1.`Overall G` AS `SCHOOL_TEAM_1_Overall G`,school_stats1.`Overall SRS` AS `SCHOOL_TEAM_1_Overall SRS`,school_stats1.`Overall SOS` AS `SCHOOL_TEAM_1_Overall SOS`,school_stats1.`Points Tm.` AS `SCHOOL_TEAM_1_Points Tm.`,school_stats1.`Points Opp.` AS `SCHOOL_TEAM_1_Points Opp.`,school_stats1.`Totals MP` AS `SCHOOL_TEAM_1_Totals MP`,school_stats1.`Totals FG` AS `SCHOOL_TEAM_1_Totals FG`,school_stats1.`Totals FGA` AS `SCHOOL_TEAM_1_Totals FGA`,school_stats1.`Totals FG%` AS `SCHOOL_TEAM_1_Totals FG%`,school_stats1.`Totals 3P` AS `SCHOOL_TEAM_1_Totals 3P`,school_stats1.`Totals 3PA` AS `SCHOOL_TEAM_1_Totals 3PA`,school_stats1.`Totals 3P%` AS `SCHOOL_TEAM_1_Totals 3P%`,school_stats1.`Totals FT` AS `SCHOOL_TEAM_1_Totals FT`,school_stats1.`Totals FTA` AS `SCHOOL_TEAM_1_Totals FTA`,school_stats1.`Totals FT%` AS `SCHOOL_TEAM_1_Totals FT%`,school_stats1.`Totals ORB` AS `SCHOOL_TEAM_1_Totals ORB`,school_stats1.`Totals TRB` AS `SCHOOL_TEAM_1_Totals TRB`,school_stats1.`Totals AST` AS `SCHOOL_TEAM_1_Totals AST`,school_stats1.`Totals STL` AS `SCHOOL_TEAM_1_Totals STL`,school_stats1.`Totals BLK` AS `SCHOOL_TEAM_1_Totals BLK`,school_stats1.`Totals TOV` AS `SCHOOL_TEAM_1_Totals TOV`,school_stats1.`Totals PF` AS `SCHOOL_TEAM_1_Totals PF`,school_stats1.`School Advanced Pace` AS `SCHOOL_TEAM_1_School Advanced Pace`,school_stats1.`School Advanced ORtg` AS `SCHOOL_TEAM_1_School Advanced ORtg`,school_stats1.`School Advanced FTr` AS `SCHOOL_TEAM_1_School Advanced FTr`,school_stats1.`School Advanced 3PAr` AS `SCHOOL_TEAM_1_School Advanced 3PAr`,school_stats1.`School Advanced TS%` AS `SCHOOL_TEAM_1_School Advanced TS%`,school_stats1.`School Advanced TRB%` AS `SCHOOL_TEAM_1_School Advanced TRB%`,school_stats1.`School Advanced AST%` AS `SCHOOL_TEAM_1_School Advanced AST%`,school_stats1.`School Advanced STL%` AS `SCHOOL_TEAM_1_School Advanced STL%`,school_stats1.`School Advanced BLK%` AS `SCHOOL_TEAM_1_School Advanced BLK%`,school_stats1.`School Advanced eFG%` AS `SCHOOL_TEAM_1_School Advanced eFG%`,school_stats1.`School Advanced TOV%` AS `SCHOOL_TEAM_1_School Advanced TOV%`,school_stats1.`School Advanced ORB%` AS `SCHOOL_TEAM_1_School Advanced ORB%`,school_stats1.`School Advanced FT/FGA` AS `SCHOOL_TEAM_1_School Advanced FT/FGA`, school_stats2.`Overall G` AS `SCHOOL_TEAM_2_Overall G`,school_stats2.`Overall SRS` AS `SCHOOL_TEAM_2_Overall SRS`,school_stats2.`Overall SOS` AS `SCHOOL_TEAM_2_Overall SOS`,school_stats2.`Points Tm.` AS `SCHOOL_TEAM_2_Points Tm.`,school_stats2.`Points Opp.` AS `SCHOOL_TEAM_2_Points Opp.`,school_stats2.`Totals MP` AS `SCHOOL_TEAM_2_Totals MP`,school_stats2.`Totals FG` AS `SCHOOL_TEAM_2_Totals FG`,school_stats2.`Totals FGA` AS `SCHOOL_TEAM_2_Totals FGA`,school_stats2.`Totals FG%` AS `SCHOOL_TEAM_2_Totals FG%`,school_stats2.`Totals 3P` AS `SCHOOL_TEAM_2_Totals 3P`,school_stats2.`Totals 3PA` AS `SCHOOL_TEAM_2_Totals 3PA`,school_stats2.`Totals 3P%` AS `SCHOOL_TEAM_2_Totals 3P%`,school_stats2.`Totals FT` AS `SCHOOL_TEAM_2_Totals FT`,school_stats2.`Totals FTA` AS `SCHOOL_TEAM_2_Totals FTA`,school_stats2.`Totals FT%` AS `SCHOOL_TEAM_2_Totals FT%`,school_stats2.`Totals ORB` AS `SCHOOL_TEAM_2_Totals ORB`,school_stats2.`Totals TRB` AS `SCHOOL_TEAM_2_Totals TRB`,school_stats2.`Totals AST` AS `SCHOOL_TEAM_2_Totals AST`,school_stats2.`Totals STL` AS `SCHOOL_TEAM_2_Totals STL`,school_stats2.`Totals BLK` AS `SCHOOL_TEAM_2_Totals BLK`,school_stats2.`Totals TOV` AS `SCHOOL_TEAM_2_Totals TOV`,school_stats2.`Totals PF` AS `SCHOOL_TEAM_2_Totals PF`,school_stats2.`School Advanced Pace` AS `SCHOOL_TEAM_2_School Advanced Pace`,school_stats2.`School Advanced ORtg` AS `SCHOOL_TEAM_2_School Advanced ORtg`,school_stats2.`School Advanced FTr` AS `SCHOOL_TEAM_2_School Advanced FTr`,school_stats2.`School Advanced 3PAr` AS `SCHOOL_TEAM_2_School Advanced 3PAr`,school_stats2.`School Advanced TS%` AS `SCHOOL_TEAM_2_School Advanced TS%`,school_stats2.`School Advanced TRB%` AS `SCHOOL_TEAM_2_School Advanced TRB%`,school_stats2.`School Advanced AST%` AS `SCHOOL_TEAM_2_School Advanced AST%`,school_stats2.`School Advanced STL%` AS `SCHOOL_TEAM_2_School Advanced STL%`,school_stats2.`School Advanced BLK%` AS `SCHOOL_TEAM_2_School Advanced BLK%`,school_stats2.`School Advanced eFG%` AS `SCHOOL_TEAM_2_School Advanced eFG%`,school_stats2.`School Advanced TOV%` AS `SCHOOL_TEAM_2_School Advanced TOV%`,school_stats2.`School Advanced ORB%` AS `SCHOOL_TEAM_2_School Advanced ORB%`,school_stats2.`School Advanced FT/FGA` AS `SCHOOL_TEAM_2_School Advanced FT/FGA`, opponent_stats1.`Overall G` AS `OPPONENT_TEAM_1_Overall G`,opponent_stats1.`Overall SRS` AS `OPPONENT_TEAM_1_Overall SRS`,opponent_stats1.`Overall SOS` AS `OPPONENT_TEAM_1_Overall SOS`,opponent_stats1.`Points Tm.` AS `OPPONENT_TEAM_1_Points Tm.`,opponent_stats1.`Points Opp.` AS `OPPONENT_TEAM_1_Points Opp.`,opponent_stats1.`Opponent MP` AS `OPPONENT_TEAM_1_Opponent MP`,opponent_stats1.`Opponent FG` AS `OPPONENT_TEAM_1_Opponent FG`,opponent_stats1.`Opponent FGA` AS `OPPONENT_TEAM_1_Opponent FGA`,opponent_stats1.`Opponent FG%` AS `OPPONENT_TEAM_1_Opponent FG%`,opponent_stats1.`Opponent 3P` AS `OPPONENT_TEAM_1_Opponent 3P`,opponent_stats1.`Opponent 3PA` AS `OPPONENT_TEAM_1_Opponent 3PA`,opponent_stats1.`Opponent 3P%` AS `OPPONENT_TEAM_1_Opponent 3P%`,opponent_stats1.`Opponent FT` AS `OPPONENT_TEAM_1_Opponent FT`,opponent_stats1.`Opponent FTA` AS `OPPONENT_TEAM_1_Opponent FTA`,opponent_stats1.`Opponent FT%` AS `OPPONENT_TEAM_1_Opponent FT%`,opponent_stats1.`Opponent ORB` AS `OPPONENT_TEAM_1_Opponent ORB`,opponent_stats1.`Opponent TRB` AS `OPPONENT_TEAM_1_Opponent TRB`,opponent_stats1.`Opponent AST` AS `OPPONENT_TEAM_1_Opponent AST`,opponent_stats1.`Opponent STL` AS `OPPONENT_TEAM_1_Opponent STL`,opponent_stats1.`Opponent BLK` AS `OPPONENT_TEAM_1_Opponent BLK`,opponent_stats1.`Opponent TOV` AS `OPPONENT_TEAM_1_Opponent TOV`,opponent_stats1.`Opponent PF` AS `OPPONENT_TEAM_1_Opponent PF`,opponent_stats1.`MadeTournament` AS `OPPONENT_TEAM_1_MadeTournament`,opponent_stats1.`Opponent Advanced Pace` AS `OPPONENT_TEAM_1_Opponent Advanced Pace`,opponent_stats1.`Opponent Advanced ORtg` AS `OPPONENT_TEAM_1_Opponent Advanced ORtg`,opponent_stats1.`Opponent Advanced FTr` AS `OPPONENT_TEAM_1_Opponent Advanced FTr`,opponent_stats1.`Opponent Advanced 3PAr` AS `OPPONENT_TEAM_1_Opponent Advanced 3PAr`,opponent_stats1.`Opponent Advanced TS%` AS `OPPONENT_TEAM_1_Opponent Advanced TS%`,opponent_stats1.`Opponent Advanced TRB%` AS `OPPONENT_TEAM_1_Opponent Advanced TRB%`,opponent_stats1.`Opponent Advanced AST%` AS `OPPONENT_TEAM_1_Opponent Advanced AST%`,opponent_stats1.`Opponent Advanced STL%` AS `OPPONENT_TEAM_1_Opponent Advanced STL%`,opponent_stats1.`Opponent Advanced BLK%` AS `OPPONENT_TEAM_1_Opponent Advanced BLK%`,opponent_stats1.`Opponent Advanced eFG%` AS `OPPONENT_TEAM_1_Opponent Advanced eFG%`,opponent_stats1.`Opponent Advanced TOV%` AS `OPPONENT_TEAM_1_Opponent Advanced TOV%`,opponent_stats1.`Opponent Advanced ORB%` AS `OPPONENT_TEAM_1_Opponent Advanced ORB%`,opponent_stats1.`Opponent Advanced FT/FGA` AS `OPPONENT_TEAM_1_Opponent Advanced FT/FGA`, opponent_stats2.`Overall G` AS `OPPONENT_TEAM_2_Overall G`,opponent_stats2.`Overall SRS` AS `OPPONENT_TEAM_2_Overall SRS`,opponent_stats2.`Overall SOS` AS `OPPONENT_TEAM_2_Overall SOS`,opponent_stats2.`Points Tm.` AS `OPPONENT_TEAM_2_Points Tm.`,opponent_stats2.`Points Opp.` AS `OPPONENT_TEAM_2_Points Opp.`,opponent_stats2.`Opponent MP` AS `OPPONENT_TEAM_2_Opponent MP`,opponent_stats2.`Opponent FG` AS `OPPONENT_TEAM_2_Opponent FG`,opponent_stats2.`Opponent FGA` AS `OPPONENT_TEAM_2_Opponent FGA`,opponent_stats2.`Opponent FG%` AS `OPPONENT_TEAM_2_Opponent FG%`,opponent_stats2.`Opponent 3P` AS `OPPONENT_TEAM_2_Opponent 3P`,opponent_stats2.`Opponent 3PA` AS `OPPONENT_TEAM_2_Opponent 3PA`,opponent_stats2.`Opponent 3P%` AS `OPPONENT_TEAM_2_Opponent 3P%`,opponent_stats2.`Opponent FT` AS `OPPONENT_TEAM_2_Opponent FT`,opponent_stats2.`Opponent FTA` AS `OPPONENT_TEAM_2_Opponent FTA`,opponent_stats2.`Opponent FT%` AS `OPPONENT_TEAM_2_Opponent FT%`,opponent_stats2.`Opponent ORB` AS `OPPONENT_TEAM_2_Opponent ORB`,opponent_stats2.`Opponent TRB` AS `OPPONENT_TEAM_2_Opponent TRB`,opponent_stats2.`Opponent AST` AS `OPPONENT_TEAM_2_Opponent AST`,opponent_stats2.`Opponent STL` AS `OPPONENT_TEAM_2_Opponent STL`,opponent_stats2.`Opponent BLK` AS `OPPONENT_TEAM_2_Opponent BLK`,opponent_stats2.`Opponent TOV` AS `OPPONENT_TEAM_2_Opponent TOV`,opponent_stats2.`Opponent PF` AS `OPPONENT_TEAM_2_Opponent PF`,opponent_stats2.`MadeTournament` AS `OPPONENT_TEAM_2_MadeTournament`,opponent_stats2.`Opponent Advanced Pace` AS `OPPONENT_TEAM_2_Opponent Advanced Pace`,opponent_stats2.`Opponent Advanced ORtg` AS `OPPONENT_TEAM_2_Opponent Advanced ORtg`,opponent_stats2.`Opponent Advanced FTr` AS `OPPONENT_TEAM_2_Opponent Advanced FTr`,opponent_stats2.`Opponent Advanced 3PAr` AS `OPPONENT_TEAM_2_Opponent Advanced 3PAr`,opponent_stats2.`Opponent Advanced TS%` AS `OPPONENT_TEAM_2_Opponent Advanced TS%`,opponent_stats2.`Opponent Advanced TRB%` AS `OPPONENT_TEAM_2_Opponent Advanced TRB%`,opponent_stats2.`Opponent Advanced AST%` AS `OPPONENT_TEAM_2_Opponent Advanced AST%`,opponent_stats2.`Opponent Advanced STL%` AS `OPPONENT_TEAM_2_Opponent Advanced STL%`,opponent_stats2.`Opponent Advanced BLK%` AS `OPPONENT_TEAM_2_Opponent Advanced BLK%`,opponent_stats2.`Opponent Advanced eFG%` AS `OPPONENT_TEAM_2_Opponent Advanced eFG%`,opponent_stats2.`Opponent Advanced TOV%` AS `OPPONENT_TEAM_2_Opponent Advanced TOV%`,opponent_stats2.`Opponent Advanced ORB%` AS `OPPONENT_TEAM_2_Opponent Advanced ORB%`,opponent_stats2.`Opponent Advanced FT/FGA` AS `OPPONENT_TEAM_2_Opponent Advanced FT/FGA`, kenpom_team1.`AdjEM` AS `TEAM_1_AdjEM`,kenpom_team1.`AdjO` AS `TEAM_1_AdjO`,kenpom_team1.`AdjD` AS `TEAM_1_AdjD`,kenpom_team1.`AdjT` AS `TEAM_1_AdjT`,kenpom_team1.`Luck` AS `TEAM_1_Luck`,kenpom_team1.`Strength of Schedule_AdjEM` AS `TEAM_1_Strength of Schedule_AdjEM`,kenpom_team1.`Strength of Schedule_OppO` AS `TEAM_1_Strength of Schedule_OppO`,kenpom_team1.`Strength of Schedule_OppD` AS `TEAM_1_Strength of Schedule_OppD`,kenpom_team1.`NCSOS_AdjEM` AS `TEAM_1_NCSOS_AdjEM`, kenpom_team2.`AdjEM` AS `TEAM_2_AdjEM`,kenpom_team2.`AdjO` AS `TEAM_2_AdjO`,kenpom_team2.`AdjD` AS `TEAM_2_AdjD`,kenpom_team2.`AdjT` AS `TEAM_2_AdjT`,kenpom_team2.`Luck` AS `TEAM_2_Luck`,kenpom_team2.`Strength of Schedule_AdjEM` AS `TEAM_2_Strength of Schedule_AdjEM`,kenpom_team2.`Strength of Schedule_OppO` AS `TEAM_2_Strength of Schedule_OppO`,kenpom_team2.`Strength of Schedule_OppD` AS `TEAM_2_Strength of Schedule_OppD`,kenpom_team2.`NCSOS_AdjEM` AS `TEAM_2_NCSOS_AdjEM`, ratings_team1.`Pts` AS `SCHOOL_TEAM_1_Pts`,ratings_team1.`Opp` AS `SCHOOL_TEAM_1_Opp`,ratings_team1.`MOV` AS `SCHOOL_TEAM_1_MOV`,ratings_team1.`SOS` AS `SCHOOL_TEAM_1_SOS`,ratings_team1.`SRS OSRS` AS `SCHOOL_TEAM_1_SRS OSRS`,ratings_team1.`SRS DSRS` AS `SCHOOL_TEAM_1_SRS DSRS`,ratings_team1.`SRS SRS` AS `SCHOOL_TEAM_1_SRS SRS`,ratings_team1.`Adjusted ORtg` AS `SCHOOL_TEAM_1_Adjusted ORtg`,ratings_team1.`Adjusted DRtg` AS `SCHOOL_TEAM_1_Adjusted DRtg`,ratings_team1.`Adjusted NRtg` AS `SCHOOL_TEAM_1_Adjusted NRtg`, ratings_team2.`Pts` AS `SCHOOL_TEAM_2_Pts`,ratings_team2.`Opp` AS `SCHOOL_TEAM_2_Opp`,ratings_team2.`MOV` AS `SCHOOL_TEAM_2_MOV`,ratings_team2.`SOS` AS `SCHOOL_TEAM_2_SOS`,ratings_team2.`SRS OSRS` AS `SCHOOL_TEAM_2_SRS OSRS`,ratings_team2.`SRS DSRS` AS `SCHOOL_TEAM_2_SRS DSRS`,ratings_team2.`SRS SRS` AS `SCHOOL_TEAM_2_SRS SRS`,ratings_team2.`Adjusted ORtg` AS `SCHOOL_TEAM_2_Adjusted ORtg`,ratings_team2.`Adjusted DRtg` AS `SCHOOL_TEAM_2_Adjusted DRtg`,ratings_team2.`Adjusted NRtg` AS `SCHOOL_TEAM_2_Adjusted NRtg` FROM schedule_stats schst INNER JOIN school_season_stats school_stats1 ON schst.`Team 1` = school_stats1.School AND schst.Year = school_stats1.Year INNER JOIN school_season_stats school_stats2 ON schst.`Team 2` = school_stats2.School AND schst.Year = school_stats2.Year INNER JOIN opponent_season_stats opponent_stats1 ON schst.`Team 1` = opponent_stats1.School AND schst.Year = opponent_stats1.Year INNER JOIN opponent_season_stats opponent_stats2 ON schst.`Team 2` = opponent_stats2.School AND schst.Year = opponent_stats2.Year INNER JOIN team_mapping team_map1 ON schst.`Team 1` = team_map1.`Sports Reference` INNER JOIN team_mapping team_map2 ON schst.`Team 2` = team_map2.`Sports Reference` INNER JOIN kenpom_stats kenpom_team1 ON kenpom_team1.Team = team_map1.Kenpom AND schst.Year = kenpom_team1.Year INNER JOIN kenpom_stats kenpom_team2 ON kenpom_team2.Team = team_map2.Kenpom AND schst.Year = kenpom_team2.Year INNER JOIN ratings_sr ratings_team1 ON schst.`Team 1` = ratings_team1.School AND schst.Year = ratings_team1.Year INNER JOIN ratings_sr ratings_team2 ON schst.`Team 2` = ratings_team2.School AND schst.Year = ratings_team2.Year WHERE Type = '{}' AND schst.Year >= 2010"

# String of feature importances.
FEATURE_IMPORTANCE_STRING = "[0.02217951 0.00625488 0.00508438 0.0048641  0.00480286 0.00426715 0.00784808 0.00431238 0.00459494 0.00536849 0.00452024 0.00486863 0.00440376 0.00470421 0.00519804 0.00473048 0.0046181  0.00439729 0.02042212 0.00618797 0.00538202 0.00524515 0.00517619 0.00456849 0.00854265 0.0047808  0.00502525 0.00513533 0.004817   0.00536729 0.00461444 0.00495493 0.00513923 0.00496731 0.00485302 0.00484453 0.02115794 0.00601065 0.00513116 0.00506035 0.00481704 0.00265388 0.00415663 0.00596343 0.00467367 0.00480163 0.00586679 0.00471912 0.0050973  0.00448195 0.00470123 0.0056528  0.0045044  0.00459037 0.0046333  0.02059837 0.00584037 0.00537286 0.00501983 0.00508225 0.00277475 0.00467728 0.00629783 0.00492421 0.00517666 0.00589364 0.00476839 0.00521697 0.00483699 0.00495596 0.00522557 0.00481493 0.00464862 0.00510931 0.02703924 0.01195093 0.01061566 0.00430001 0.01035843 0.00558648 0.00476543 0.00477187 0.00542195 0.02191305 0.01096546 0.00957119 0.00472783 0.00940952 0.00560854 0.00493637 0.00497648 0.00553226 0.00496749 0.00471784 0.02043263 0.00575966 0.0082657  0.00707889 0.02142403 0.01058031 0.01063769 0.01596373 0.00502007 0.00518613 0.02034767 0.00625984 0.00812874 0.00792258 0.02376187 0.0105868  0.00924223 0.01647474 0.00423676 0.00473702 0.00472645 0.00475331 0.00471231 0.00469032 0.0045971  0.00471194 0.00483664 0.00507455 0.00487898 0.00511833 0.00505673 0.00488146 0.01350388 0.01373392 0.0077362  0.00604368 0.00603293 0.00655548 0.00631686 0.00604847 0.01044536 0.00991285 0.00597339 0.00648334 0.00606253 0.00598022]"

def main():
    """Main Function"""
    # Gets Column list in the order retrieved
    df = get_data(QUERY, True)
    df = df.drop(columns=["Result"])
    column_list = df.columns.tolist()

    # Converts Feature Importance String into a list of floats.
    feature_importance_string = FEATURE_IMPORTANCE_STRING.replace('[', '')
    feature_importance_string = feature_importance_string.replace(']', '')
    feature_importance_string_list = feature_importance_string.split(' ')
    column_weight_list = []
    for weight in feature_importance_string_list:
        if weight != '':
            column_weight_list.append(float(weight))

    # Verification Step to make sure there are the same number of columns as weights
    if len(column_weight_list) != len(column_list):
        raise ValueError("Mismatching number of Feature Importances and Columns in Query")

    # Creates the Table which will then be printed.
    table = PrettyTable()
    table.field_names = ["Feature", "Weight"]
    for weight in column_weight_list:
        table.add_row([column_list[column_weight_list.index(weight)], weight])

    # Table Parameters used to sort the table
    table.sortby='Weight'
    table.reversesort = True

    print(table)

if __name__ == "__main__":
    main()
